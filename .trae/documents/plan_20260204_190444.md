# PlugClipboard 混合内容支持升级计划

非常抱歉之前的表述引起了误解。您的理解是完全正确的，实际上并不存在“优先检测”的问题，而是应当 **同时支持**。我们的目标是让插件能够智能地处理剪贴板中的混合内容（既包含文本也包含图片，或者只有其中之一），并完整地记录下来。

根据您的指正，我们将调整实现逻辑，确保“所见即所得”地记录用户复制的内容。

## 阶段一：全类型数据捕获 (Content Script)
1.  **重构事件监听逻辑** (`content.js`)：
    *   在 `copy` 事件中，全面遍历 `clipboardData.items`。
    *   **并行处理**：同时检查是否存在文本 (`text/plain`) 和图片 (`image/*`) 数据。
    *   **数据打包**：将捕获到的内容封装为一个对象，例如 `{ type: 'mixed', text: "...", image: "base64..." }`。如果只有图片则为 `{ type: 'image', ... }`，只有文本则为 `{ type: 'text', ... }`。
    *   **图片优化（关键点）**：为了保证“运行流畅”，对捕获到的图片数据进行 **Canvas 压缩处理**，生成体积可控的 Base64 字符串，防止大数据量阻塞插件运行。

## 阶段二：统一存储管理 (Background Script)
1.  **升级存储结构** (`background.js`)：
    *   修改存储的数据结构，使其能兼容存储文本和图片数据。
    *   保持 20 条记录的总上限不变。
2.  **去重逻辑升级**：
    *   针对混合内容实现更智能的去重（例如：文本相同但图片不同，视为新记录）。

## 阶段三：富媒体 UI 渲染 (UI Rendering)
1.  **列表项样式升级** (`content.css`)：
    *   重新设计列表项 (`li`) 样式，使其能自适应展示内容。
    *   **纯文本**：保持现有显示方式。
    *   **纯图片**：显示图片缩略图。
    *   **图文混合**：同时显示文本摘要和图片缩略图。
2.  **智能回填实现**：
    *   点击记录时，根据记录类型调用 `navigator.clipboard.write()`。
    *   如果是图文混合记录，尝试同时写入 `text/plain` 和 `image/png` 到剪贴板（视浏览器兼容性而定，通常浏览器支持同时写入）。

## 阶段四：验证
1.  **测试场景**：
    *   复制纯文本。
    *   复制网页上的图片（右键复制图片）。
    *   复制包含图片和文字的混合选区。
2.  **性能检查**：
    *   确认连续复制多张大图时，插件响应依然流畅。
